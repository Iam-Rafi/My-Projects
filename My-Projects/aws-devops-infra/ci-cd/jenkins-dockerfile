FROM jenkins/jenkins:lts

# Switch to root to install packages
USER root

# Install required tools: Docker, Maven, Git
RUN apt-get update && \
    apt-get install -y docker.io maven git && \
    rm -rf /var/lib/apt/lists/*

# Add Jenkins to docker group so it can run Docker commands
RUN usermod -aG docker jenkins

# Switch back to Jenkins user
USER jenkins

# Expose Jenkins port
EXPOSE 8080

# Expose agent port
EXPOSE 50000

# Preinstall plugins using plugins.txt
# COPY plugins.txt /usr/share/jenkins/ref/plugins.txt
# RUN jenkins-plugin-cli -f /usr/share/jenkins/ref/plugins.txt

# Default Jenkins startup
ENTRYPOINT ["/usr/bin/tini", "--", "/usr/local/bin/jenkins.sh"]
